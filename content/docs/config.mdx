---
title: Configuration
description: Configuration settings for the server instance.
---

import { TypeTable } from 'fumadocs-ui/components/type-table';
import { Callout } from 'fumadocs-ui/components/callout';

# Configuration

The configuration file controls the server behavior, audio quality, sources, and cluster scaling.

## Server Settings

Core settings for the server instance.

<TypeTable
  type={{
    host: {
      description: 'The IP address to bind the server to.',
      type: 'string',
      default: '"0.0.0.0"'
    },
    port: {
      description: 'The port to listen on.',
      type: 'number',
      default: '3000'
    },
    password: {
      description: 'Authentication password for clients.',
      type: 'string',
      default: '"youshallnotpass"'
    },
    useBunServer: {
      description: 'Set to true to use Bun.serve websocket implementation.',
      type: 'boolean',
      default: 'false'
    }
  }}
/>

<Callout type="warn" title="Experimental Feature">
  `useBunServer` is currently experimental. Use with caution in production environments.
</Callout>

---

## Cluster & Scaling

Settings related to worker clustering and auto-scaling behavior.

### General Cluster Options

<TypeTable
  type={{
    enabled: {
      description: 'Activates clustering mode. Can also be set via env CLUSTER_ENABLED.',
      type: 'boolean',
      default: 'true'
    },
    workers: {
      description: 'Number of workers to spawn. 0 uses os.cpus().length.',
      type: 'number',
      default: '0'
    },
    minWorkers: {
      description: 'Minimum workers to keep alive to improve availability during bursts.',
      type: 'number',
      default: '1'
    },
    specializedSourceWorker: {
      description: 'Dedicated worker pool for source loading (search, lyrics, etc.).',
      type: 'object'
    },
    commandTimeout: {
      description: 'Timeout (ms) for heavy operations like loadTracks.',
      type: 'number',
      default: '6000'
    },
    fastCommandTimeout: {
      description: 'Timeout (ms) for fast player commands like play/pause.',
      type: 'number',
      default: '4000'
    },
    maxRetries: {
      description: 'Number of retry attempts on timeout or worker failure.',
      type: 'number',
      default: '2'
    },
    hibernation: {
      description: 'Worker hibernation settings for idle periods.',
      type: 'object'
    },
    endpoint: {
      description: 'Controls the /v4/workers endpoint behavior.',
      type: 'object'
    }
  }}
/>

### Specialized Source Workers

<TypeTable
  type={{
    enabled: {
      description: 'If true, source loading is delegated to dedicated workers.',
      type: 'boolean',
      default: 'true'
    },
    count: {
      description: 'Number of separate process clusters for source operations.',
      type: 'number',
      default: '1'
    },
    microWorkers: {
      description: 'Number of worker threads per source process cluster.',
      type: 'number',
      default: '2'
    },
    tasksPerWorker: {
      description: 'Max parallel tasks each micro-worker can handle before queuing.',
      type: 'number',
      default: '32'
    },
    silentLogs: {
      description: 'If true, micro-workers only log warnings and errors.',
      type: 'boolean',
      default: 'true'
    }
  }}
/>

### Hibernation

<TypeTable
  type={{
    enabled: {
      description: 'If true, idle workers enter efficiency mode to reduce CPU usage.',
      type: 'boolean',
      default: 'true'
    },
    timeoutMs: {
      description: 'Idle time (ms) before a worker enters hibernation.',
      type: 'number',
      default: '1200000'
    }
  }}
/>

### Scaling Configuration

These settings control the `cluster.scaling` behavior.

<TypeTable
  type={{
    maxPlayersPerWorker: {
      description: 'Reference capacity for utilization calculation.',
      type: 'number',
      default: '20'
    },
    targetUtilization: {
      description: 'Target utilization factor for scaling logic.',
      type: 'number',
      default: '0.7'
    },
    scaleUpThreshold: {
      description: 'Utilization threshold (0.0 - 1.0) to trigger scaling up.',
      type: 'number',
      default: '0.75'
    },
    scaleDownThreshold: {
      description: 'Utilization threshold (0.0 - 1.0) to trigger scaling down.',
      type: 'number',
      default: '0.3'
    },
    checkIntervalMs: {
      description: 'Interval (ms) to check for scaling needs.',
      type: 'number',
      default: '5000'
    },
    idleWorkerTimeoutMs: {
      description: 'Time (ms) an idle worker waits before being removed.',
      type: 'number',
      default: '60000'
    },
    queueLengthScaleUpFactor: {
      description: 'How many commands in queue per active worker trigger scale up.',
      type: 'number',
      default: '5'
    },
    lagPenaltyLimit: {
      description: 'Event loop lag threshold (ms) that increases worker cost.',
      type: 'number',
      default: '60'
    },
    cpuPenaltyLimit: {
      description: 'CPU usage threshold (0-1) that increases worker cost.',
      type: 'number',
      default: '0.85'
    }
  }}
/>

### Workers Endpoint

<TypeTable
  type={{
    patchEnabled: {
      description: 'If true, PATCH /v4/workers can terminate a worker.',
      type: 'boolean',
      default: 'true'
    },
    allowExternalPatch: {
      description: 'If true, allows non-loopback clients to use PATCH /v4/workers.',
      type: 'boolean',
      default: 'false'
    },
    code: {
      description: 'Shared secret required for PATCH /v4/workers.',
      type: 'string',
      default: '"CAPYBARA"'
    }
  }}
/>

---

## Audio & Player

Configuration for audio quality, updates, and playback behavior.

<TypeTable
  type={{
    'audio.quality': {
      description: 'Preferred audio quality.',
      type: 'string',
      default: '"high"'
    },
    'audio.encryption': {
      description: 'Encryption method for packets.',
      type: 'string',
      default: '"aead_aes256_gcm_rtpsize"'
    },
    'audio.resamplingQuality': {
      description: 'Resampling strategy.',
      type: 'string',
      default: '"best"'
    },
    playerUpdateInterval: {
      description: 'How often player updates are sent to the client (ms).',
      type: 'number',
      default: '2000'
    },
    statsUpdateInterval: {
      description: 'How often worker stats are aggregated (ms).',
      type: 'number',
      default: '30000'
    },
    trackStuckThresholdMs: {
      description: 'Time to wait before declaring a track stuck.',
      type: 'number',
      default: '10000'
    },
    zombieThresholdMs: {
      description: 'Threshold to detect zombie connections.',
      type: 'number',
      default: '60000'
    },
    enableHoloTracks: {
      description: 'Enables HoloTracks functionality.',
      type: 'boolean',
      default: 'false'
    },
    enableTrackStreamEndpoint: {
      description: 'Enables the /v4/trackstream endpoint.',
      type: 'boolean',
      default: 'false'
    },
    enableLoadStreamEndpoint: {
      description: 'Enables the /v4/loadstream endpoint (raw PCM stream).',
      type: 'boolean',
      default: 'false'
    },
    resolveExternalLinks: {
      description: 'Automatically resolves external links (Spotify/Apple Music) in track metadata.',
      type: 'boolean',
      default: 'false'
    },
    fetchChannelInfo: {
      description: 'Automatically fetches detailed channel information for YouTube tracks.',
      type: 'boolean',
      default: 'false'
    }
  }}
/>

---

## Sources

Configuration for specific music and media providers.

### Primary Platforms

<TypeTable
  type={{
    defaultSearchSource: {
      description: 'Default sources used when none is specified (fallback order).',
      type: 'string[]',
      default: '["youtube", "soundcloud"]'
    },
    unifiedSearchSources: {
      description: 'Sources included in unified search.',
      type: 'string[]',
      default: '["youtube", "soundcloud"]'
    }
  }}
/>

### YouTube

<TypeTable
  type={{
    enabled: { type: 'boolean', default: 'true' },
    allowItag: { 
      description: 'Additional itags for audio streams (e.g., [140, 141]).',
      type: 'number[]', 
      default: '[]' 
    },
    targetItag: { 
      description: 'Force a specific itag, overriding quality options.',
      type: 'number | null', 
      default: 'null' 
    },
    'clients.search': {
      description: 'Clients used for searching.',
      type: 'string[]',
      default: '["Android"]'
    },
    'clients.playback': {
      description: 'Clients used for playback.',
      type: 'string[]',
      default: '["AndroidVR", "TV", "TVEmbedded", "IOS"]'
    },
    'cipher.url': {
      description: 'URL for the signature cipher service.',
      type: 'string',
      default: '"http://127.0.0.1:8001"'
    }
  }}
/>

### Spotify

<TypeTable
  type={{
    enabled: { type: 'boolean', default: 'true' },
    clientId: { type: 'string', default: '""' },
    clientSecret: { type: 'string', default: '""' },
    externalAuthUrl: {
      description: 'External token provider for auth (optional).',
      type: 'string',
      default: '"http://get.1lucas1apk.fun/spotify/gettoken"'
    },
    market: { type: 'string', default: '"US"' },
    playlistLoadLimit: { 
      description: 'Pages to load (1 = 100 tracks). 0 for no limit.',
      type: 'number', 
      default: '1' 
    },
    playlistPageLoadConcurrency: { type: 'number', default: '10' },
    allowExplicit: { type: 'boolean', default: 'true' }
  }}
/>

### Apple Music

<TypeTable
  type={{
    enabled: { type: 'boolean', default: 'true' },
    mediaApiToken: { 
      description: 'Manually provide token or use "token_here" for auto-fetch.',
      type: 'string', 
      default: '"token_here"' 
    },
    playlistLoadLimit: { type: 'number', default: '0' },
    allowExplicit: { type: 'boolean', default: 'true' }
  }}
/>

### Tidal

<TypeTable
  type={{
    enabled: { type: 'boolean', default: 'true' },
    token: { 
      description: 'Valid authentication token.',
      type: 'string', 
      default: '""' 
    },
    countryCode: { type: 'string', default: '"US"' }
  }}
/>

### Other Sources

<TypeTable
  type={{
    deezer: { description: 'Enabled by default. Supports ARL/Decryption Key.', type: 'object' },
    jiosaavn: { description: 'Supports playlist/artist load limits.', type: 'object' },
    vkmusic: { description: 'VK Music source. Supports userToken/userCookie.', type: 'object' },
    amazonmusic: { description: 'Amazon Music source.', type: 'object' },
    mixcloud: { description: 'Mixcloud source.', type: 'object' },
    telegram: { description: 'Telegram audio source.', type: 'object' },
    bilibili: { description: 'Bilibili source (supports sessdata).', type: 'object' },
    genius: { description: 'Genius source.', type: 'object' },
    pinterest: { description: 'Pinterest source.', type: 'object' },
    pandora: { description: 'May require manual CSRF token or remoteTokenUrl due to region locks.', type: 'object' },
    local: { description: 'Local file playback. Base path configurable.', type: 'object' },
    http: { description: 'Direct HTTP stream playback.', type: 'boolean' },
    soundcloud: { description: 'SoundCloud source (optional clientId).', type: 'object' },
    'google-tts': { 
      description: 'Google Text-to-Speech. Configurable language.', 
      type: 'object',
      default: '{ language: "en-US" }'
    },
    flowery: { 
      description: 'Flowery TTS. Configurable voice, speed, silence.', 
      type: 'object',
      default: '{ voice: "Salli", speed: 1.0 }'
    }
  }}
/>

### VK Music

<TypeTable
  type={{
    enabled: { type: 'boolean', default: 'true' },
    userToken: {
      description: 'Optional VK user token from web session.',
      type: 'string',
      default: '""'
    },
    userCookie: {
      description: 'VK cookie header from web session (required if userToken is empty).',
      type: 'string',
      default: '""'
    },
    recommendationsLoadLimit: {
      description: 'Max recommendation tracks to return.',
      type: 'number',
      default: '10'
    }
  }}
/>

### Bilibili

<TypeTable
  type={{
    enabled: { type: 'boolean', default: 'true' },
    sessdata: {
      description: 'Optional sessdata cookie for premium/4k access.',
      type: 'string',
      default: '""'
    }
  }}
/>

### Pandora

<TypeTable
  type={{
    enabled: { type: 'boolean', default: 'true' },
    csrfToken: {
      description: 'Optional CSRF token (US-only; manual fetch).',
      type: 'string',
      default: '""'
    },
    remoteTokenUrl: {
      description: 'Remote token provider URL.',
      type: 'string',
      default: '"https://get.1lucas1apk.fun/pandora/gettoken"'
    }
  }}
/>

---

## Lyrics

Configuration for lyrics providers.

<TypeTable
  type={{
    fallbackSource: {
      description: 'Source to use if the primary fails.',
      type: 'string',
      default: '"genius"'
    },
    'applemusic.advanceSearch': {
      description: 'Uses YTMusic to match title/artist for better accuracy.',
      type: 'boolean',
      default: 'true'
    }
  }}
/>

**Supported Providers:** YouTube, Genius, Musixmatch, LRCLib, Apple Music, Bilibili.

---

## Security & Rate Limiting

### DOS Protection

<TypeTable
  type={{
    enabled: { type: 'boolean', default: 'true' },
    'thresholds.burstRequests': { type: 'number', default: '50' },
    'thresholds.timeWindowMs': { type: 'number', default: '10000' },
    'mitigation.blockDurationMs': { type: 'number', default: '300000' }
  }}
/>

### Rate Limit (Global & Per Entity)

<TypeTable
  type={{
    enabled: { type: 'boolean', default: 'true' },
    'global.maxRequests': { type: 'number', default: '1000' },
    'perIp.maxRequests': { type: 'number', default: '100' },
    'perUserId.maxRequests': { type: 'number', default: '50' },
    'perGuildId.maxRequests': { type: 'number', default: '20' }
  }}
/>

### Route Planner (IP Rotation)

<TypeTable
  type={{
    strategy: {
      description: 'Strategy for IP rotation (RotateOnBan, RoundRobin, LoadBalance).',
      type: 'string',
      default: '"RotateOnBan"'
    },
    bannedIpCooldown: {
      description: 'Time (ms) an IP remains banned.',
      type: 'number',
      default: '600000'
    },
    ipBlocks: {
      description: 'List of IP blocks to use.',
      type: 'string[]',
      default: '[]'
    }
  }}
/>

---

## Voice Receive

<TypeTable
  type={{
    enabled: {
      description: 'Enables receiving voice from Discord.',
      type: 'boolean',
      default: 'false'
    },
    format: {
      description: 'Audio format for incoming voice data.',
      type: 'string',
      default: '"opus"'
    }
  }}
/>

---

## Logging & Metrics

<TypeTable
  type={{
    'logging.level': {
      type: 'string',
      default: '"debug"'
    },
    'logging.file.enabled': {
      type: 'boolean',
      default: 'false'
    },
    'metrics.enabled': {
      type: 'boolean',
      default: 'false'
    },
    'metrics.authorization.type': {
      type: 'string',
      default: '"Bearer"'
    }
  }}
/>

---

## Plugins

Configuration for loading and managing plugins.

<TypeTable
  type={{
    plugins: {
      description: 'List of plugins to load.',
      type: 'array',
      default: '[{ name: "nodelink-sample-plugin", source: "local" }]'
    },
    pluginConfig: {
      description: 'Configuration object for specific plugins.',
      type: 'object',
      default: '{}'
    }
  }}
/>

